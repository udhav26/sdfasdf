<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Udhav's List — Stable</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'><rect width='256' height='256' rx='56' fill='%23222'/><path d='M64 132l36 36 92-92' stroke='%23fff' stroke-width='24' fill='none' stroke-linecap='round' stroke-linejoin='round'/></svg>">
<style>
:root{--bg:#0b0f14;--bg2:#0f141b;--card:#131a22;--card2:#111821;--text:#e6ebf3;--muted:#9fb0c6;--accent:#a78bfa;--accent2:#7c3aed;--ring:rgba(167,139,250,.5);--radius:16px;--shadow:0 10px 30px rgba(0,0,0,.35);--wp-image:none;--wp-size:cover;--wp-blur:0px;--wp-dim:.35}
body.theme-midnight{--bg:#0b0f14;--bg2:#0f141b;--card:#131a22;--card2:#111821;--text:#e6ebf3;--muted:#9fb0c6;--accent:#a78bfa;--accent2:#7c3aed;--ring:rgba(167,139,250,.5)}
body.theme-minimal{--bg:#f6f7fb;--bg2:#fff;--card:#fff;--card2:#f1f4fa;--text:#0f1320;--muted:#667190;--accent:#3b82f6;--accent2:#1d4ed8;--ring:rgba(59,130,246,.5)}
body.theme-emerald{--bg:#081210;--bg2:#0c1916;--card:#0f1f1b;--card2:#0c1a16;--text:#e9fbf6;--muted:#a3d8cb;--accent:#34d399;--accent2:#059669;--ring:rgba(52,211,153,.5)}
body.theme-rose{--bg:#1a1214;--bg2:#201417;--card:#25171b;--card2:#221419;--text:#ffeaf0;--muted:#f5adc3;--accent:#fb7185;--accent2:#e11d48;--ring:rgba(251,113,133,.5)}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:ui-rounded,ui-sans-serif,system-ui,-apple-system,Inter,Roboto;background:radial-gradient(1200px 800px at 80% -10%,var(--bg2),transparent),radial-gradient(1200px 800px at -10% 120%,var(--bg2),transparent),var(--bg);color:var(--text)}
body::before,body::after{content:"";position:fixed;inset:0;z-index:-2}body::before{background-image:var(--wp-image);background-size:var(--wp-size);background-position:center;background-repeat:no-repeat;filter:blur(var(--wp-blur));transform:scale(1.05)}body::after{z-index:-1;background:linear-gradient(180deg,rgba(0,0,0,var(--wp-dim)),rgba(0,0,0,calc(var(--wp-dim)+.05)))}
.app{max-width:1100px;margin:0 auto;padding:16px}header{position:sticky;top:0;z-index:5;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0;backdrop-filter:saturate(1.2) blur(6px)}
.title{display:flex;align-items:center;gap:10px;font-weight:800}.logo{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:var(--shadow)}h1{margin:0;font-size:22px}
.toolbar{display:flex;gap:8px;flex-wrap:wrap}.btn{appearance:none;border:none;background:var(--card2);color:var(--text);padding:10px 14px;border-radius:12px;font-weight:700;box-shadow:var(--shadow);cursor:pointer}.btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2))}.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.08)}
.searchbar{display:flex;gap:10px;margin-top:8px}.searchbar input{flex:1;padding:12px 14px;border-radius:14px;background:var(--card2);color:var(--text);border:1px solid rgba(255,255,255,.06);outline:none}.searchbar input:focus{box-shadow:0 0 0 3px var(--ring)}
.filters{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}.chip{padding:8px 12px;border-radius:999px;background:var(--card2);border:1px solid rgba(255,255,255,.06);color:var(--text);font-weight:600;font-size:13px;cursor:pointer}.chip.active{background:linear-gradient(135deg,var(--accent),var(--accent2));border-color:transparent}
.layout{display:grid;grid-template-columns:260px 1fr;gap:16px;margin-top:16px}@media (max-width:900px){.layout{grid-template-columns:1fr}}
.panel{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow)}.panel .header{padding:14px 14px 0;font-weight:800;opacity:.95}.panel .body{padding:14px}
.projects{display:flex;flex-direction:column;gap:8px}.project{display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;background:var(--card);border:1px solid rgba(255,255,255,.06);cursor:pointer}.project .dot{width:10px;height:10px;border-radius:50%}.project .name{font-weight:700}.project small{color:var(--muted)}.project.active{outline:3px solid var(--ring)}
.addbar{display:flex;gap:10px;margin-bottom:10px}.addbar input[type=text]{flex:1;padding:14px;border-radius:14px;background:var(--card2);color:var(--text);border:1px solid rgba(255,255,255,.06);outline:none;font-weight:700}
.field{background:var(--card2);padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.06)}.field label{display:block;font-size:11px;opacity:.7;margin-bottom:6px}.field input,.field select,.field textarea{width:100%;background:transparent;border:none;color:var(--text);outline:none;font-size:13px}
.add-adv{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:8px;margin-bottom:14px}
.tasks{display:flex;flex-direction:column;gap:10px}.task{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:12px;box-shadow:var(--shadow)}.task-header{display:flex;align-items:center;gap:10px}
.checkbox{width:22px;height:22px;border-radius:6px;border:2px solid var(--muted);display:grid;place-items:center;cursor:pointer}.checkbox.done{border-color:transparent;background:linear-gradient(135deg,var(--accent),var(--accent2))}
.task .title{font-weight:800}.meta{margin-left:auto;display:flex;align-items:center;gap:8px}.iconbtn{display:grid;place-items:center;width:36px;height:36px;border-radius:10px;background:var(--card2);border:1px solid rgba(255,255,255,.06);cursor:pointer}
.pill{padding:6px 10px;border-radius:999px;background:var(--card2);border:1px solid rgba(255,255,255,.06);font-size:12px;font-weight:700;color:var(--muted)}.pill.crit{background:linear-gradient(135deg,#ef4444,#b91c1c);color:#fff;border:none}.pill.high{background:linear-gradient(135deg,#fb923c,#ea580c);color:#111}.pill.med{background:linear-gradient(135deg,#facc15,#eab308);color:#111}.pill.low{background:linear-gradient(135deg,#34d399,#059669);color:#fff}
.task-details{margin-top:10px;display:none;grid-template-columns:1fr;gap:10px}.task.open .task-details{display:grid}.tags{display:flex;gap:6px;flex-wrap:wrap}.tag{padding:5px 10px;font-size:11px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);color:var(--text)}
.footerbar{display:flex;align-items:center;justify-content:space-between;margin-top:12px;color:var(--muted);font-size:12px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:var(--card);border:1px solid rgba(255,255,255,.08);padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);font-weight:700;z-index:50;display:none;gap:12px;align-items:center}
.toast .undo{padding:6px 10px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:#fff;font-weight:800;cursor:pointer}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:40}.sheet{width:min(680px,92vw);background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
.sheet .head{display:flex;align-items:center;justify-content:space-between;padding:14px;background:var(--card2)}.sheet .content{padding:14px;display:grid;gap:12px}.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media (max-width:560px){.row{grid-template-columns:1fr}}
</style>
</head>
<body class="theme-midnight">
<div class="app">
  <header>
    <div class="title">
      <div class="logo">✓</div>
      <h1>Udhav's List</h1>
      <span style="opacity:.6;font-weight:700;">— aesthetic todos</span>
    </div>
    <div class="toolbar">
      <select id="theme" class="btn">
        <option value="theme-midnight">Midnight</option>
        <option value="theme-minimal">Minimal</option>
        <option value="theme-emerald">Emerald</option>
        <option value="theme-rose">Rose</option>
      </select>
      <button id="wallBtn" class="btn">Wallpaper</button>
      <button id="exportBtn" class="btn ghost">Export</button>
      <label class="btn ghost" for="importFile">Import</label>
      <input type="file" id="importFile" accept="application/json" style="display:none">
      <button id="clearBtn" class="btn">Clear</button>
    </div>
  </header>

  <div class="searchbar">
    <input id="search" placeholder="Search tasks, tags, notes… ( / to focus )">
    <button id="newProject" class="btn">New Project</button>
  </div>

  <div class="filters">
    <div class="chip" data-f="inbox">Inbox</div>
    <div class="chip" data-f="today">Today</div>
    <div class="chip" data-f="upcoming">Upcoming</div>
    <div class="chip" data-f="completed">Completed</div>
    <div class="chip active" data-f="all">All</div>
  </div>

  <div class="layout">
    <div class="panel">
      <div class="header">Projects</div>
      <div class="body projects" id="projects"></div>
    </div>
    <div class="panel">
      <div class="body">
        <div class="addbar">
          <input id="title" type="text" placeholder="Quick add a task… ( Enter )">
          <button id="addBtn" class="btn primary">Add</button>
        </div>
        <div class="add-adv">
          <div class="field"><label>Due</label><input id="due" type="date"></div>
          <div class="field"><label>Priority</label><select id="prio"><option value="med">Medium</option><option value="low">Low</option><option value="high">High</option><option value="crit">Critical</option></select></div>
          <div class="field"><label>Project</label><select id="proj"></select></div>
          <div class="field"><label>Tags</label><input id="tags" placeholder="comma,separated"></div>
          <div class="field"><label>Repeat</label><select id="repeat"><option value="none">None</option><option value="daily">Daily</option><option value="weekly">Weekly</option><option value="monthly">Monthly</option></select></div>
        </div>
        <div class="tasks" id="tasks"></div>
        <div class="footerbar"><div id="counts"></div></div>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="wp">
  <div class="sheet">
    <div class="head"><strong>Wallpaper</strong><button class="btn ghost" id="wpClose">Close</button></div>
    <div class="content">
      <div class="row">
        <div class="field"><label>Upload Image</label><input type="file" id="wpFile" accept="image/*"></div>
        <div class="field"><label>From URL</label><input type="url" id="wpUrl" placeholder="https://example.com/wallpaper.jpg"></div>
      </div>
      <div class="row">
        <div class="field"><label>Blur</label><input type="range" min="0" max="16" step="1" id="wpBlur"></div>
        <div class="field"><label>Dim</label><input type="range" min="0" max="0.7" step="0.05" id="wpDim"></div>
      </div>
      <div class="row">
        <div class="field"><label>Fit</label><select id="wpFit"><option value="cover">Cover</option><option value="contain">Contain</option></select></div>
        <div class="field" style="display:flex;align-items:end;gap:8px">
          <button class="btn" id="wpApply">Apply</button>
          <button class="btn ghost" id="wpRemove">Remove</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"><span id="toastMsg"></span><button class="undo" id="undoBtn" style="display:none">Undo</button></div>

<script>
(function(){
  var DB = 'udhav.list.ultrastable.v1';
  var state = load() || init();
  var filter = 'all';

  // Elements
  function $(id){ return document.getElementById(id); }
  var projectsEl = $('projects'), tasksEl = $('tasks');
  var titleEl = $('title'), dueEl = $('due'), prioEl = $('prio'), projEl = $('proj'), tagsEl = $('tags'), repeatEl = $('repeat');
  var themeEl = $('theme');

  // Init
  applyTheme(state.settings.theme);
  applyWallpaper(state.settings.wallpaper);
  buildProjects();
  fillProjectSelector();
  render();

  // Header actions
  themeEl.onchange = function(){ applyTheme(this.value); toast('Theme updated'); };
  $('exportBtn').onclick = function(){ var blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'}); var url = URL.createObjectURL(blob); var a = document.createElement('a'); a.href=url; a.download='udhav_list_export.json'; a.click(); setTimeout(function(){URL.revokeObjectURL(url);}, 1000); };
  $('importFile').onchange = function(ev){ var f = ev.target.files[0]; if(!f) return; var r=new FileReader(); r.onload=function(){ try{ var data=JSON.parse(r.result); if(!data.tasks||!data.projects) throw new Error('Invalid file'); state=data; save(); location.reload(); }catch(e){ alert('Import failed: '+e.message); } }; r.readAsText(f); };
  $('clearBtn').onclick = function(){ if(confirm('Clear all data?')){ localStorage.removeItem(DB); location.reload(); } };
  $('newProject').onclick = function(){ var n = prompt('Project name'); if(!n) return; var p = {id: uid(), name:n, color:'#9ca3af'}; state.projects.push(p); save(); buildProjects(); fillProjectSelector(); toast('Project added'); };

  // Filters
  Array.prototype.forEach.call(document.querySelectorAll('.filters .chip[data-f]'), function(chip){
    chip.addEventListener('click', function(){
      Array.prototype.forEach.call(document.querySelectorAll('.filters .chip[data-f]'), function(c){ c.classList.remove('active'); });
      this.classList.add('active'); filter = this.getAttribute('data-f'); render();
    });
  });

  // Add task
  $('addBtn').onclick = add;
  titleEl.addEventListener('keydown', function(e){ if(e.key==='Enter') add(); });

  // Search
  $('search').oninput = render;
  window.addEventListener('keydown', function(e){ if(e.key==='/'){ e.preventDefault(); $('search').focus(); } });

  // Wallpaper modal
  var wp = $('wp');
  $('wallBtn').onclick = function(){ syncWpControls(); wp.style.display='flex'; };
  $('wpClose').onclick = function(){ wp.style.display='none'; };
  $('wpApply').onclick = function(){ var w = { url:$('wpUrl').value.trim(), blur:+$('wpBlur').value||0, dim:+$('wpDim').value||0.35, fit:$('wpFit').value||'cover' }; state.settings.wallpaper=w; save(); applyWallpaper(w); wp.style.display='none'; toast('Wallpaper updated'); };
  $('wpRemove').onclick = function(){ state.settings.wallpaper=null; save(); applyWallpaper(null); syncWpControls(); toast('Wallpaper removed'); };
  $('wpFile').onchange = function(ev){ var f=ev.target.files[0]; if(!f) return; var r=new FileReader(); r.onload=function(){ $('wpUrl').value = r.result; }; r.readAsDataURL(f); };
  function syncWpControls(){ var w = state.settings.wallpaper || {url:'',blur:8,dim:0.35,fit:'cover'}; $('wpUrl').value=w.url||''; $('wpBlur').value=w.blur||8; $('wpDim').value=w.dim||0.35; $('wpFit').value=w.fit||'cover'; }

  // Core
  function init(){
    var inbox = {id: uid(), name:'Inbox', color:'#9fb0c6'};
    return { settings:{ theme:'theme-midnight', wallpaper:null },
      projects:[inbox, {id:uid(), name:'Work', color:'#34d399'}, {id:uid(), name:'Personal', color:'#60a5fa'}],
      tasks:[ mkTask('Welcome to Udhav\'s List ✨', inbox.id, {priority:'high', tags:['intro','demo']}),
              mkTask('Tap a task to open details', inbox.id, {tags:['tips']}),
              mkTask('Set a due date →', inbox.id, {due: today(1), tags:['today']}) ] };
  }
  function mkTask(title, projectId, opts){ opts=opts||{}; return { id:uid(), title:title, notes:opts.notes||'', createdAt:new Date().toISOString(), updatedAt:new Date().toISOString(), due:opts.due||'', projectId:projectId, tags:opts.tags||[], priority:opts.priority||'med', completed:false, repeat:opts.repeat||'none' }; }
  function load(){ try{ return JSON.parse(localStorage.getItem(DB)); }catch(e){ return null; } }
  function save(){ localStorage.setItem(DB, JSON.stringify(state)); }
  function uid(){ return Math.random().toString(36).slice(2,10); }
  function today(add){ var d=new Date(); d.setDate(d.getDate()+(add||0)); d.setHours(0,0,0,0); return d.toISOString().slice(0,10); }
  function applyTheme(t){ document.body.className = t; state.settings.theme=t; save(); $('theme').value=t; }
  function applyWallpaper(w){ if(!w || !w.url){ document.documentElement.style.setProperty('--wp-image','none'); document.documentElement.style.setProperty('--wp-blur','0px'); document.documentElement.style.setProperty('--wp-dim','0.0'); return; } document.documentElement.style.setProperty('--wp-image',"url('"+w.url+"')"); document.documentElement.style.setProperty('--wp-size', w.fit||'cover'); document.documentElement.style.setProperty('--wp-blur', (w.blur||0)+'px'); document.documentElement.style.setProperty('--wp-dim', String((typeof w.dim==='number'?w.dim:0.35))); }
  function buildProjects(){ projectsEl.innerHTML=''; state.projects.forEach(function(p){ var wrap=document.createElement('div'); wrap.className='project'; wrap.datasetId=p.id; wrap.innerHTML='<div class="dot" style="background:'+p.color+'"></div><div class="name">'+esc(p.name)+'</div><small>• '+state.tasks.filter(function(t){return t.projectId===p.id && !t.completed;}).length+'</small><div style="margin-left:auto;display:flex;gap:6px;"><button class="btn ghost" data-act="edit">Edit</button><button class="btn ghost" data-act="del">Delete</button></div>'; wrap.addEventListener('click', function(e){ var act=(e.target && e.target.getAttribute('data-act'))||''; if(act==='edit'){ e.stopPropagation(); var nn=prompt('Rename project',p.name); if(!nn) return; p.name=nn; save(); buildProjects(); render(); return;} if(act==='del'){ e.stopPropagation(); if(p===state.projects[0]){ alert('Cannot delete Inbox'); return;} if(confirm('Delete project and move its tasks to Inbox?')){ var inboxId=state.projects[0].id; state.tasks.forEach(function(t){ if(t.projectId===p.id) t.projectId=inboxId; }); state.projects=state.projects.filter(function(x){ return x.id!==p.id; }); save(); buildProjects(); fillProjectSelector(); render(); } return;} var nodes=document.querySelectorAll('.project'); for(var i=0;i<nodes.length;i++){ nodes[i].classList.remove('active'); } wrap.classList.add('active'); filter='project:'+p.id; var chips=document.querySelectorAll('.filters .chip'); for(var j=0;j<chips.length;j++){ chips[j].classList.remove('active'); } render(); }); projectsEl.appendChild(wrap); }); }
  function fillProjectSelector(){ projEl.innerHTML=''; state.projects.forEach(function(p){ var o=document.createElement('option'); o.value=p.id; o.textContent=p.name; projEl.appendChild(o); }); projEl.value=state.projects[0].id; }
  function add(){ var title=titleEl.value.trim(); if(!title) return; var t = mkTask(title, projEl.value, { due:dueEl.value, priority:prioEl.value, tags:tagsEl.value.split(',').map(function(s){return s.trim();}).filter(Boolean), repeat:repeatEl.value }); state.tasks.unshift(t); save(); titleEl.value=''; tagsEl.value=''; dueEl.value=''; render(); toast('Task added'); }
  function render(){ var q=$('search').value.toLowerCase(); var list=state.tasks.slice(); var todayISO=today(0); if(filter==='inbox'){ list=list.filter(function(t){ return t.projectId===state.projects[0].id && !t.completed; }); } else if(filter==='today'){ list=list.filter(function(t){ return !t.completed && t.due===todayISO; }); } else if(filter==='upcoming'){ list=list.filter(function(t){ return !t.completed && t.due && t.due>todayISO; }); } else if(filter==='completed'){ list=list.filter(function(t){ return t.completed; }); } else if(filter.indexOf('project:')===0){ var pid=filter.split(':')[1]; list=list.filter(function(t){ return t.projectId===pid && !t.completed; }); } if(q){ list=list.filter(function(t){ return (t.title+' '+t.notes+' '+t.tags.join(' ')).toLowerCase().indexOf(q)!==-1; }); } var pr={crit:3,high:2,med:1,low:0}; list.sort(function(a,b){ if(a.completed!==b.completed) return a.completed?1:-1; if((a.due||'')!==(b.due||'')) return (a.due||'')<(b.due||'')?-1:1; var d=pr[b.priority]-pr[a.priority]; if(d) return d; return 0; }); tasksEl.innerHTML=''; var done=state.tasks.filter(function(t){return t.completed;}).length; var active=state.tasks.length-done; $('counts').textContent=active+' active • '+done+' done'; for(var i=0;i<list.length;i++){ tasksEl.appendChild(renderTask(list[i])); } }
  function renderTask(t){ var el=document.createElement('div'); el.className='task'; var overdue=t.due && t.due<today(0) && !t.completed; var dueLabel=t.due?(overdue?'Overdue ':'')+t.due:'No due'; var tags=t.tags.map(function(tag){return '<span class="tag">#'+esc(tag)+'</span>';}).join(' '); el.innerHTML='<div class="task-header"><div class="checkbox '+(t.completed?'done':'')+'" data-act="toggle">'+(t.completed?'✓':'')+'</div><div class="title" style="flex:1">'+esc(t.title)+'</div><div class="meta"><span class="pill '+t.priority+'">'+t.priority+'</span><span class="pill">'+dueLabel+'</span><button class="iconbtn" title="Details" data-act="open">⋯</button><button class="iconbtn" title="Delete" data-act="trash">🗑️</button></div></div><div class="task-details"><div class="field"><label>Notes</label><textarea rows="3" data-field="notes">'+esc(t.notes)+'</textarea></div><div style="display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:8px"><div class="field"><label>Due</label><input type="date" data-field="due" value="'+(t.due||'')+'"></div><div class="field"><label>Priority</label><select data-field="priority"><option value="low" '+(t.priority==='low'?'selected':'')+'>Low</option><option value="med" '+(t.priority==='med'?'selected':'')+'>Medium</option><option value="high" '+(t.priority==='high'?'selected':'')+'>High</option><option value="crit" '+(t.priority==='crit'?'selected':'')+'>Critical</option></select></div><div class="field"><label>Project</label><select data-field="projectId">'+state.projects.map(function(p){return '<option value=\"'+p.id+'\" '+(t.projectId===p.id?'selected':'')+'>'+esc(p.name)+'</option>';}).join('')+'</select></div><div class="field"><label>Repeat</label><select data-field="repeat"><option value="none" '+(t.repeat==='none'?'selected':'')+'>None</option><option value="daily" '+(t.repeat==='daily'?'selected':'')+'>Daily</option><option value="weekly" '+(t.repeat==='weekly'?'selected':'')+'>Weekly</option><option value="monthly" '+(t.repeat==='monthly'?'selected':'')+'>Monthly</option></select></div></div><div class="field"><label>Tags (comma separated)</label><input data-field="tags" value="'+esc(t.tags.join(', '))+'"></div><div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn" data-act="snooze">Snooze +1d</button><button class="btn" data-act="dup">Duplicate</button><button class="btn ghost" data-act="del">Delete</button></div><div class="tags">'+tags+'</div></div>'; el.addEventListener('click', function(e){ var act=(e.target && e.target.getAttribute('data-act'))||''; if(act==='toggle'){ t.completed=!t.completed; save(); render(); } if(act==='open'){ el.classList.toggle('open'); } if(act==='trash' || act==='del'){ deleteTask(t); } if(act==='snooze'){ t.due=t.due||today(0); var d=new Date(t.due); d.setDate(d.getDate()+1); t.due = d.toISOString().slice(0,10); save(); render(); toast('Snoozed +1 day'); } if(act==='dup'){ var c=JSON.parse(JSON.stringify(t)); c.id=uid(); c.completed=false; c.title=t.title+' (copy)'; state.tasks.unshift(c); save(); render(); } }); Array.prototype.forEach.call(el.querySelectorAll('.task-details [data-field]'), function(inp){ inp.addEventListener('change', function(){ var f=inp.getAttribute('data-field'); var v=inp.value; if(f==='tags'){ v=v.split(',').map(function(s){return s.trim();}).filter(Boolean); } t[f]=v; t.updatedAt=new Date().toISOString(); save(); render(); }); }); return el; }
  function deleteTask(t){ var idx=state.tasks.findIndex(function(x){return x.id===t.id;}); if(idx<0) return; var removed=state.tasks.splice(idx,1)[0]; save(); render(); toast('Task deleted','Undo',function(){ state.tasks.unshift(removed); save(); render(); }); }
  var toastTimer=null; function toast(msg, action, handler){ var el=$('toast'), undo=$('undoBtn'); $('toastMsg').textContent=msg; if(action && handler){ undo.textContent=action; undo.style.display='inline-block'; undo.onclick=function(){ handler(); el.style.display='none'; }; } else{ undo.style.display='none'; undo.onclick=null; } el.style.display='flex'; if(toastTimer) clearTimeout(toastTimer); toastTimer=setTimeout(function(){ el.style.display='none'; },2200); }
  function esc(s){ return String(s||'').replace(/[&<>\"']/g,function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',\"'\":'&#39;'}[m]; }); }
})();</script>
</body>
</html>
